<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeFlow â€” Open Source Architecture Intelligence</title>
    <meta name="description" content="Visualize any GitHub repository's architecture in seconds. See dependencies, blast radius, code ownership, security issues, and design patterns. No installation required.">
    <meta name="keywords" content="code visualization, architecture, github, dependency graph, blast radius, code analysis, open source">
    <meta name="author" content="CodeFlow">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="CodeFlow â€” Visualize Your Codebase Architecture">
    <meta property="og:description" content="Turn any GitHub repo into an interactive architecture map in seconds. Zero setup, privacy-first, runs in your browser.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://via.placeholder.com/1200x630?text=CodeFlow">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="CodeFlow â€” Visualize Your Codebase Architecture">
    <meta name="twitter:description" content="Turn any GitHub repo into an interactive architecture map in seconds. Zero setup, privacy-first.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš¡</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <style>
:root{--bg0:#0a0a0c;--bg1:#0f0f12;--bg2:#161619;--bg3:#1c1c21;--bg4:#252529;--hover:#2a2a30;--border:#2d2d35;--border2:#222228;--t0:#f0f0f2;--t1:#c8c8cd;--t2:#8b8b95;--t3:#5c5c66;--acc:#00ff9d;--acc2:#00cc7d;--accbg:rgba(0,255,157,0.08);--blue:#4d9fff;--purple:#a78bfa;--orange:#ff9f43;--red:#ff5f5f;--cyan:#22d3ee;--pink:#ec4899;--green:#22c55e}
.light{--bg0:#fff;--bg1:#f8f9fa;--bg2:#f1f3f4;--bg3:#e8eaed;--bg4:#dadce0;--hover:#e2e4e8;--border:#dadce0;--border2:#e8eaed;--t0:#1a1a1a;--t1:#3c3c3c;--t2:#6c6c6c;--t3:#9c9c9c;--acc:#00a86b;--acc2:#008f5b;--accbg:rgba(0,168,107,0.08)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'JetBrains Mono',monospace;background:var(--bg0);color:var(--t0);height:100vh;overflow:hidden}
.app{display:flex;height:100vh;flex-direction:column}
.topbar{height:48px;background:var(--bg1);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 16px;gap:16px;flex-shrink:0}
.logo{display:flex;align-items:center;gap:10px;cursor:pointer}
.logo-mark{width:28px;height:28px;background:linear-gradient(135deg,var(--acc),var(--cyan));border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:14px}
.logo-text{font-size:14px;font-weight:700;color:var(--acc)}
.repo-input-group{display:flex;gap:8px;flex:1;max-width:500px}
.repo-input{flex:1;padding:6px 12px;background:var(--bg0);border:1px solid var(--border);border-radius:6px;color:var(--t0);font-family:inherit;font-size:11px}
.repo-input:focus{outline:none;border-color:var(--acc)}
.topbar-actions{display:flex;gap:6px;margin-left:auto}
.top-btn{padding:6px 12px;background:var(--bg3);border:1px solid var(--border);border-radius:6px;color:var(--t1);font-family:inherit;font-size:10px;cursor:pointer;display:flex;align-items:center;gap:6px;white-space:nowrap}
.top-btn:hover{background:var(--bg4);border-color:var(--acc);color:var(--acc)}
.top-btn.primary{background:var(--acc);color:var(--bg0);border-color:var(--acc)}
.top-btn.primary:hover{background:var(--acc2)}
.top-btn:disabled{opacity:0.5;cursor:not-allowed}
.main{display:flex;flex:1;overflow:hidden}
.sidebar{width:260px;background:var(--bg1);border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0}
.sidebar-section{padding:12px;border-bottom:1px solid var(--border)}
.sidebar-title{font-size:9px;font-weight:600;color:var(--t3);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px}
.sidebar-scroll{flex:1;overflow-y:auto;padding:8px}
.sidebar-scroll::-webkit-scrollbar{width:6px}
.sidebar-scroll::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
.view-modes{display:flex;flex-direction:column;gap:2px}
.view-mode{display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:6px;cursor:pointer;font-size:11px;color:var(--t1)}
.view-mode:hover{background:var(--hover)}
.view-mode.active{background:var(--accbg);color:var(--acc)}
.view-mode-icon{font-size:14px}
.view-mode-badge{margin-left:auto;font-size:9px;background:var(--red);color:white;padding:2px 6px;border-radius:8px}
.stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:6px}
.stat-card{background:var(--bg0);border:1px solid var(--border2);border-radius:6px;padding:10px;text-align:center}
.stat-value{font-size:18px;font-weight:700;color:var(--acc)}
.stat-label{font-size:8px;color:var(--t3);text-transform:uppercase;margin-top:2px}
.stat-card.warn .stat-value{color:var(--orange)}
.health-score{display:flex;align-items:center;gap:12px;padding:12px;background:var(--bg0);border-radius:8px}
.health-ring{width:48px;height:48px;position:relative}
.health-ring svg{transform:rotate(-90deg)}
.health-ring-value{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700}
.health-info{flex:1}
.health-grade{font-size:16px;font-weight:700}
.health-label{font-size:9px;color:var(--t3)}
.tree-folder{display:flex;align-items:center;gap:6px;padding:5px 8px;border-radius:4px;cursor:pointer;font-size:11px;color:var(--t1)}
.tree-folder:hover{background:var(--hover)}
.tree-folder.filtered{background:var(--accbg);color:var(--acc)}
.tree-toggle{width:12px;font-size:8px;color:var(--t3);transition:transform 0.15s}
.tree-toggle.open{transform:rotate(90deg)}
.tree-name{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.tree-count{font-size:9px;color:var(--t3);background:var(--bg3);padding:1px 5px;border-radius:8px}
.tree-children{margin-left:16px}
.tree-file{display:flex;align-items:center;gap:6px;padding:4px 8px;margin-left:18px;border-radius:4px;cursor:pointer;font-size:10px;color:var(--t2)}
.tree-file:hover{background:var(--hover);color:var(--t0)}
.tree-file.active{background:var(--accbg);color:var(--acc)}
.canvas-area{flex:1;position:relative;background:var(--bg0);overflow:hidden}
.canvas-area svg{width:100%;height:100%;display:block}
.canvas-toolbar{position:absolute;top:12px;left:12px;display:flex;gap:4px;z-index:50}
.canvas-info{position:absolute;bottom:12px;left:12px;display:flex;gap:8px;z-index:50}
.info-chip{padding:6px 10px;background:var(--bg1);border:1px solid var(--border);border-radius:6px;font-size:10px;color:var(--t2)}
.info-chip strong{color:var(--acc)}
.tool-btn{width:32px;height:32px;background:var(--bg1);border:1px solid var(--border);border-radius:6px;color:var(--t2);font-size:13px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.tool-btn:hover{background:var(--bg2);color:var(--t0);border-color:var(--acc)}
.legend{position:absolute;top:12px;right:12px;background:var(--bg1);border:1px solid var(--border);border-radius:8px;padding:12px;z-index:50;min-width:140px;max-height:300px;overflow-y:auto}
.legend::-webkit-scrollbar{width:4px}
.legend::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
.legend-title{font-size:9px;font-weight:600;color:var(--t3);text-transform:uppercase;margin-bottom:8px}
.legend-item{display:flex;align-items:center;gap:8px;font-size:10px;color:var(--t2);margin-bottom:4px;cursor:pointer;padding:2px 4px;border-radius:4px}
.legend-item:hover{background:var(--hover)}
.legend-item.active{background:var(--accbg);color:var(--acc)}
.legend-color{width:12px;height:12px;border-radius:3px;flex-shrink:0}
.right-panel{width:360px;background:var(--bg1);border-left:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0}
.panel-tabs{display:flex;border-bottom:1px solid var(--border);background:var(--bg2)}
.panel-tab{flex:1;padding:8px;background:transparent;border:none;border-bottom:2px solid transparent;color:var(--t3);font-family:inherit;font-size:9px;font-weight:600;cursor:pointer}
.panel-tab:hover{color:var(--t1)}
.panel-tab.active{color:var(--acc);border-bottom-color:var(--acc)}
.panel-content{flex:1;overflow-y:auto;padding:12px}
.panel-content::-webkit-scrollbar{width:6px}
.panel-content::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
.card{background:var(--bg0);border:1px solid var(--border2);border-radius:8px;margin-bottom:8px;overflow:hidden}
.card-header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;cursor:pointer}
.card-header:hover{background:var(--hover)}
.card-title{font-size:11px;color:var(--t0);display:flex;align-items:center;gap:8px}
.card-toggle{font-size:8px;color:var(--t3);transition:transform 0.15s}
.card-toggle.open{transform:rotate(90deg)}
.card-body{padding:12px;border-top:1px solid var(--border2);background:var(--bg2)}
.badge{font-size:9px;font-weight:600;padding:2px 6px;border-radius:6px}
.badge-default{background:var(--bg3);color:var(--t2)}
.badge-success{background:rgba(34,197,94,0.2);color:var(--green)}
.badge-warning{background:rgba(255,159,67,0.2);color:var(--orange)}
.badge-danger{background:rgba(255,95,95,0.2);color:var(--red)}
.badge-info{background:rgba(77,159,255,0.2);color:var(--blue)}
.progress-bar{height:6px;background:var(--bg3);border-radius:3px;overflow:hidden}
.progress-fill{height:100%;border-radius:3px}
.owner-bar{display:flex;height:8px;border-radius:4px;overflow:hidden;margin:8px 0}
.owner-segment{height:100%}
.owner-list{display:flex;flex-direction:column;gap:4px}
.owner-item{display:flex;align-items:center;gap:8px;font-size:10px}
.owner-avatar{width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:9px;color:white}
.owner-name{flex:1;color:var(--t1)}
.owner-percent{color:var(--t3)}
.pattern-item{padding:12px;background:var(--bg0);border-radius:8px;margin-bottom:8px;border-left:3px solid var(--green)}
.pattern-item.anti{border-color:var(--red)}
.pattern-header{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.pattern-icon{font-size:20px}
.pattern-name{font-size:12px;color:var(--t0);font-weight:600}
.pattern-desc{font-size:10px;color:var(--t2);margin-bottom:8px;line-height:1.4}
.pattern-files{font-size:9px;color:var(--t3)}
.pattern-file{display:inline-block;background:var(--bg3);padding:2px 6px;border-radius:4px;margin:2px}
.pattern-metrics{display:flex;gap:12px;margin-top:8px;padding-top:8px;border-top:1px solid var(--border2)}
.pattern-metric{text-align:center}
.pattern-metric-value{font-size:14px;font-weight:600;color:var(--acc)}
.pattern-metric-label{font-size:8px;color:var(--t3);text-transform:uppercase}
.security-item{padding:12px;background:var(--bg0);border-radius:8px;margin-bottom:8px;border-left:3px solid;cursor:pointer}
.security-item:hover{background:var(--hover)}
.security-item.high{border-color:var(--red)}
.security-item.medium{border-color:var(--orange)}
.security-item.low{border-color:var(--blue)}
.security-header{display:flex;align-items:center;gap:8px;margin-bottom:6px}
.security-title{font-size:11px;color:var(--t0);font-weight:500}
.security-desc{font-size:10px;color:var(--t2);margin-bottom:6px;line-height:1.4}
.security-path{font-size:9px;color:var(--t3);font-family:monospace}
.security-line{font-size:9px;color:var(--acc);margin-top:4px}
.security-code{font-size:9px;background:var(--bg3);padding:6px 8px;border-radius:4px;margin-top:6px;font-family:monospace;color:var(--orange);overflow-x:auto;white-space:pre}
.fn-item{background:var(--bg0);border-radius:6px;margin-bottom:6px;overflow:hidden}
.fn-header{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;cursor:pointer}
.fn-header:hover{background:var(--hover)}
.fn-name{color:var(--cyan);font-size:10px;font-family:monospace}
.fn-line{font-size:9px;color:var(--t3)}
.fn-code{font-size:9px;background:var(--bg3);padding:8px;font-family:monospace;color:var(--t1);overflow-x:auto;white-space:pre;max-height:150px;overflow-y:auto;border-top:1px solid var(--border2)}
.blast-detail{margin-top:8px;padding-top:8px;border-top:1px solid var(--border2)}
.blast-file{display:flex;align-items:center;gap:6px;font-size:9px;color:var(--t2);padding:3px 0}
.blast-file:hover{color:var(--acc);cursor:pointer}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:1000}
.modal{background:var(--bg1);border:1px solid var(--border);border-radius:12px;width:90%;max-width:500px;max-height:80vh;overflow:hidden;display:flex;flex-direction:column}
.modal-header{padding:16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.modal-title{font-size:14px;font-weight:600;color:var(--t0)}
.modal-close{background:none;border:none;color:var(--t3);font-size:18px;cursor:pointer}
.modal-body{flex:1;overflow-y:auto;padding:16px}
.modal-footer{padding:16px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:8px}
.form-group{margin-bottom:12px}
.form-label{display:block;font-size:10px;color:var(--t2);margin-bottom:6px}
.form-input{width:100%;padding:8px 10px;background:var(--bg0);border:1px solid var(--border);border-radius:6px;color:var(--t0);font-family:inherit;font-size:11px}
.form-input:focus{outline:none;border-color:var(--acc)}
.empty-state{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;text-align:center;padding:40px}
.empty-icon{font-size:48px;margin-bottom:16px;opacity:0.3}
.empty-title{font-size:16px;font-weight:600;color:var(--t1);margin-bottom:8px}
.empty-desc{font-size:12px;color:var(--t3);max-width:300px}
.loading{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%}
.spinner{width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--acc);border-radius:50%;animation:spin 0.8s linear infinite;margin-bottom:16px}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{font-size:12px;color:var(--t2)}
.loading-progress{font-size:11px;color:var(--acc);margin-top:6px}
.tooltip{position:fixed;background:var(--bg2);border:1px solid var(--border);border-radius:6px;padding:8px 12px;pointer-events:none;z-index:1000;max-width:220px}
.tooltip-title{font-size:11px;font-weight:600;color:var(--acc)}
.tooltip-content{font-size:10px;color:var(--t2);margin-top:4px;white-space:pre-line}
.export-options{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.export-option{padding:16px;background:var(--bg0);border:1px solid var(--border);border-radius:8px;cursor:pointer;text-align:center}
.export-option:hover{border-color:var(--acc);background:var(--accbg)}
.export-option-icon{font-size:24px;margin-bottom:8px}
.export-option-label{font-size:11px;color:var(--t1)}
.pr-header{padding:12px;background:var(--bg0);border-radius:8px;margin-bottom:12px}
.pr-title{font-size:12px;color:var(--t0);font-weight:500}
.pr-stats{display:flex;gap:12px;margin-top:8px;font-size:11px}
.pr-add{color:var(--green)}
.pr-del{color:var(--red)}
.pr-file{display:flex;align-items:center;gap:8px;padding:8px;background:var(--bg0);border-radius:6px;margin-bottom:4px}
.pr-file-name{flex:1;font-size:10px;color:var(--t1);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.pr-file-impact{font-size:9px;padding:2px 6px;border-radius:4px}
.panel-header{padding:12px;border-bottom:1px solid var(--border);background:var(--bg2)}
.panel-title{font-size:12px;font-weight:600;color:var(--acc)}
.panel-subtitle{font-size:10px;color:var(--t3);margin-top:4px}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);padding:12px 24px;border-radius:8px;font-size:12px;z-index:1001;animation:slideUp 0.3s ease}
.toast.success{background:var(--green);color:white}
.toast.error{background:var(--red);color:white}
.toast.warning{background:var(--orange);color:var(--bg0)}
@keyframes slideUp{from{opacity:0;transform:translateX(-50%) translateY(20px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
.reset-btn{background:transparent;border:1px solid var(--border);color:var(--t2);padding:4px 8px;border-radius:4px;font-size:9px;cursor:pointer;margin-left:8px}
.reset-btn:hover{border-color:var(--red);color:var(--red)}
.loading-owner{display:flex;align-items:center;gap:8px;padding:12px;color:var(--t2);font-size:10px}
.loading-owner::before{content:'';width:14px;height:14px;border:2px solid var(--border);border-top-color:var(--acc);border-radius:50%;animation:spin 0.6s linear infinite}
.privacy-modal{max-width:450px}
.privacy-item{display:flex;align-items:flex-start;gap:10px;padding:10px;background:var(--bg0);border-radius:8px;margin-bottom:8px}
.privacy-icon{font-size:20px;flex-shrink:0}
.privacy-text{font-size:11px;color:var(--t1);line-height:1.5}
.privacy-title{font-weight:600;color:var(--t0);margin-bottom:4px}
.fn-callers{margin-top:8px;padding:8px;background:var(--bg0);border-radius:6px;border:1px solid var(--border)}
.fn-callers-title{font-size:9px;font-weight:600;color:var(--t3);text-transform:uppercase;margin-bottom:6px}
.fn-caller{display:flex;align-items:center;gap:6px;padding:4px 6px;border-radius:4px;font-size:10px;color:var(--t2);cursor:pointer}
.fn-caller:hover{background:var(--hover);color:var(--acc)}
    </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useRef,useMemo,useCallback}=React;
const COLORS=['#4d9fff','#a78bfa','#22d3ee','#00ff9d','#ff9f43','#ec4899','#ff5f5f','#84cc16'];
const LAYER_COLORS={ui:'#4d9fff',components:'#22d3ee',services:'#a78bfa',utils:'#00ff9d',data:'#ff9f43',config:'#ec4899'};
const IGNORE=new Set(['node_modules','.git','vendor','dist','build','__pycache__','.next','coverage']);

const Parser={
    exts:['.js','.jsx','.ts','.tsx','.py','.java','.go','.rb','.php','.vue','.svelte'],
    isCode:function(n){return Parser.exts.some(function(e){return n.toLowerCase().endsWith(e);});},
    detectLayer:function(p){
        var l=p.toLowerCase();
        if(l.includes('/ui/')||l.includes('/views/')||l.includes('/pages/'))return'ui';
        if(l.includes('/component'))return'components';
        if(l.includes('/service')||l.includes('/api/')||l.includes('/controller'))return'services';
        if(l.includes('/util')||l.includes('/helper')||l.includes('/lib/'))return'utils';
        if(l.includes('/data')||l.includes('/model')||l.includes('/store'))return'data';
        if(l.includes('/config'))return'config';
        return'utils';
    },
    detectPatterns:function(files){
        var patterns=[];
        var singletons=files.filter(function(f){return f.content&&(f.content.includes('getInstance')||f.content.match(/let\s+instance\s*=/)||f.content.match(/private\s+static\s+instance/));});
        if(singletons.length)patterns.push({name:'Singleton',icon:'ðŸ”’',desc:'Ensures a class has only one instance. Common for configuration, logging, or connection pools.',severity:'info',files:singletons.map(function(f){return{name:f.name,path:f.path};}),metrics:{instances:singletons.length}});
        var factories=files.filter(function(f){return f.content&&(f.name.toLowerCase().includes('factory')||f.content.match(/create[A-Z]\w*\s*\(/)||f.content.includes('return new'));});
        if(factories.length)patterns.push({name:'Factory',icon:'ðŸ­',desc:'Creates objects without specifying exact class. Enables loose coupling and extensibility.',severity:'info',files:factories.map(function(f){return{name:f.name,path:f.path};}),metrics:{factories:factories.length}});
        var observers=files.filter(function(f){return f.content&&(f.content.includes('subscribe')||f.content.includes('addEventListener')||f.content.includes('.on(')||f.content.includes('emit('));});
        if(observers.length)patterns.push({name:'Observer/Event',icon:'ðŸ‘ï¸',desc:'Defines a subscription mechanism for event-driven architecture. Great for decoupling.',severity:'info',files:observers.map(function(f){return{name:f.name,path:f.path};}),metrics:{emitters:observers.length}});
        var hooks=files.filter(function(f){return f.content&&f.content.match(/export\s+(?:const|function)\s+use[A-Z]/);});
        if(hooks.length)patterns.push({name:'Custom Hooks',icon:'ðŸª',desc:'React hooks for reusable stateful logic. Promotes code reuse and separation of concerns.',severity:'info',files:hooks.map(function(f){return{name:f.name,path:f.path};}),metrics:{hooks:hooks.length}});
        var hocs=files.filter(function(f){return f.content&&(f.content.match(/with[A-Z]\w*\s*=\s*\(/)||f.content.match(/export\s+default\s+connect/));});
        if(hocs.length)patterns.push({name:'Higher-Order Component',icon:'ðŸŽ',desc:'Functions that take a component and return an enhanced component.',severity:'info',files:hocs.map(function(f){return{name:f.name,path:f.path};}),metrics:{hocs:hocs.length}});
        var providers=files.filter(function(f){return f.content&&(f.content.includes('createContext')||f.content.includes('Provider')||f.content.includes('useContext'));});
        if(providers.length)patterns.push({name:'Context Provider',icon:'ðŸŒ',desc:'React Context for global state. Alternative to prop drilling.',severity:'info',files:providers.map(function(f){return{name:f.name,path:f.path};}),metrics:{contexts:providers.length}});
        var godFiles=files.filter(function(f){return f.functions&&f.functions.length>15;});
        if(godFiles.length)patterns.push({name:'God Object',icon:'âš ï¸',desc:'Files with too many responsibilities (15+ functions). Consider splitting into smaller modules.',severity:'warning',isAnti:true,files:godFiles.map(function(f){return{name:f.name,path:f.path,fns:f.functions.length};}),metrics:{files:godFiles.length,avgFns:Math.round(godFiles.reduce(function(s,f){return s+f.functions.length;},0)/godFiles.length)}});
        var longFiles=files.filter(function(f){return f.lines&&f.lines>500;});
        if(longFiles.length)patterns.push({name:'Long File',icon:'ðŸ“œ',desc:'Files over 500 lines are harder to maintain. Consider breaking into smaller modules.',severity:'warning',isAnti:true,files:longFiles.map(function(f){return{name:f.name,path:f.path,lines:f.lines};}),metrics:{files:longFiles.length,avgLines:Math.round(longFiles.reduce(function(s,f){return s+f.lines;},0)/longFiles.length)}});
        return patterns;
    },
    detectSecurity:function(files){
        var issues=[];
        files.forEach(function(f){
            if(!f.content)return;
            var lines=f.content.split('\n');
            lines.forEach(function(line,idx){
                if(line.match(/(?:password|passwd|pwd|secret|api_key|apikey|token|auth)\s*[=:]\s*['"][^'"]{4,}['"]/i)&&!line.includes('process.env')&&!line.includes('config.')){
                    issues.push({severity:'high',title:'Hardcoded Secret',file:f.name,path:f.path,line:idx+1,desc:'Credentials should never be hardcoded. Use environment variables or a secrets manager.',code:line.trim().substring(0,80)});
                }
            });
            if(f.content.match(/query\s*\(\s*['"`][^'"`]*\s*\+/)||f.content.match(/execute\s*\(\s*['"`][^'"`]*\$\{/)||f.content.match(/\$\{.*\}.*(?:SELECT|INSERT|UPDATE|DELETE)/i)){
                var m=f.content.match(/.*(query|execute|SELECT|INSERT|UPDATE|DELETE).*(\+|\$\{).*/i);
                issues.push({severity:'high',title:'SQL Injection Risk',file:f.name,path:f.path,desc:'String concatenation in SQL queries. Use parameterized queries instead.',code:m?m[0].trim().substring(0,80):''});
            }
            if(f.content.match(/innerHTML\s*=/)||f.content.match(/dangerouslySetInnerHTML/)){
                issues.push({severity:'high',title:'XSS Vulnerability',file:f.name,path:f.path,desc:'Direct HTML injection can lead to XSS attacks. Sanitize user input.',code:''});
            }
            if(f.content.includes('eval(')){
                var evalLine=lines.findIndex(function(l){return l.includes('eval(');});
                issues.push({severity:'medium',title:'Dynamic Code Execution',file:f.name,path:f.path,line:evalLine+1,desc:'eval() executes arbitrary code. Avoid if possible or validate input strictly.',code:evalLine>=0?lines[evalLine].trim().substring(0,80):''});
            }
            if(f.content.includes('Function(')||f.content.match(/new\s+Function\s*\(/)){
                issues.push({severity:'medium',title:'Function Constructor',file:f.name,path:f.path,desc:'Function constructor is similar to eval(). Consider alternatives.',code:''});
            }
            if(f.content.match(/\.exec\s*\(/)||f.content.match(/child_process/)){
                issues.push({severity:'medium',title:'Command Execution',file:f.name,path:f.path,desc:'Shell command execution detected. Ensure input is sanitized to prevent injection.',code:''});
            }
            if(f.content.match(/console\.(log|debug|info)\(/)){
                var consoleCount=(f.content.match(/console\.(log|debug|info)\(/g)||[]).length;
                if(consoleCount>3){
                    issues.push({severity:'low',title:'Debug Statements',file:f.name,path:f.path,desc:consoleCount+' console statements found. Remove before production.',code:''});
                }
            }
            if(f.content.match(/TODO|FIXME|HACK|XXX/)){
                var todoCount=(f.content.match(/TODO|FIXME|HACK|XXX/g)||[]).length;
                issues.push({severity:'low',title:'Code Comments',file:f.name,path:f.path,desc:todoCount+' TODO/FIXME comments found. Address before release.',code:''});
            }
        });
        return issues.sort(function(a,b){var sev={high:0,medium:1,low:2};return sev[a.severity]-sev[b.severity];});
    },
    extract:function(content,filename){
        var fns=new Map();
        var lines=content.split('\n');
        var skip=new Set(['if','for','while','switch','catch','constructor','get','set','new','return','class','import','export','try','else']);
        function add(name,line){
            if(name&&name.length>1&&!skip.has(name)&&!fns.has(name)){
                var code=[],braces=0,started=false;
                for(var i=Math.max(0,line-1);i<Math.min(lines.length,line+20);i++){
                    code.push(lines[i]);
                    for(var j=0;j<lines[i].length;j++){var c=lines[i][j];if(c==='{'){braces++;started=true;}if(c==='}')braces--;}
                    if(started&&braces<=0&&code.length>1)break;
                    if(code.length>=15){code.push('  // ...');break;}
                }
                fns.set(name,{name:name,file:filename,line:line,code:code.join('\n')});
            }
        }
        lines.forEach(function(line,idx){
            var m;
            if((m=line.match(/function\s+([a-zA-Z_$][a-zA-Z0-9_$]*)\s*\(/)))add(m[1],idx+1);
            if((m=line.match(/(?:const|let|var)\s+([a-zA-Z_$][a-zA-Z0-9_$]*)\s*=\s*(?:async\s*)?\(?[^)]*\)?\s*=>/)))add(m[1],idx+1);
            if((m=line.match(/(?:const|let|var)\s+([a-zA-Z_$][a-zA-Z0-9_$]*)\s*=\s*(?:async\s*)?function/)))add(m[1],idx+1);
            if((m=line.match(/^\s*(?:async\s+)?([a-zA-Z_$][a-zA-Z0-9_$]*)\s*\([^)]*\)\s*\{/)))add(m[1],idx+1);
            if((m=line.match(/export\s+(?:default\s+)?(?:async\s+)?function\s+([a-zA-Z_$][a-zA-Z0-9_$]*)/)))add(m[1],idx+1);
            if((m=line.match(/def\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*\(/)))add(m[1],idx+1);
        });
        return Array.from(fns.values());
    },
    findCalls:function(content,fnNames){
        var calls={};
        fnNames.forEach(function(fn){
            var m=content.match(new RegExp('\\b'+fn+'\\s*\\(','g'));
            if(m)calls[fn]=m.length;
        });
        return calls;
    }
};

var GitHub={
    token:null,
    fetch:function(url){
        var h={'Accept':'application/vnd.github.v3+json'};
        if(this.token)h['Authorization']='Bearer '+this.token;
        return fetch(url,{headers:h}).then(function(r){
            if(!r.ok)throw new Error(r.status===401?'Invalid token':r.status===403?'Rate limited - add a GitHub token':r.status===404?'Repository not found':'Error '+r.status);
            return r.json();
        });
    },
    getFile:function(o,r,p){
        return this.fetch('https://api.github.com/repos/'+o+'/'+r+'/contents/'+p).then(function(d){return d.content?atob(d.content):null;}).catch(function(){return null;});
    },
    getCommits:function(o,r,path,limit){
        return this.fetch('https://api.github.com/repos/'+o+'/'+r+'/commits?per_page='+(limit||30)+(path?'&path='+path:'')).catch(function(){return[];});
    },
    getBlame:function(o,r,path){
        return this.getCommits(o,r,path,50).then(function(commits){
            var authors={};
            commits.forEach(function(c){var name=c.commit.author.name;authors[name]=(authors[name]||0)+1;});
            return Object.entries(authors).map(function(e){return{name:e[0],commits:e[1],percent:Math.round(e[1]/commits.length*100)};}).sort(function(a,b){return b.commits-a.commits;});
        }).catch(function(){return[];});
    },
    getPR:function(o,r,prNum){
        var self=this;
        return this.fetch('https://api.github.com/repos/'+o+'/'+r+'/pulls/'+prNum).then(function(pr){
            return self.fetch('https://api.github.com/repos/'+o+'/'+r+'/pulls/'+prNum+'/files').then(function(files){
                pr.files=files;return pr;
            });
        }).catch(function(){return null;});
    },
    scan:function(o,r,cb,p,d){
        var self=this;p=p||'';d=d||0;
        if(d>10)return Promise.resolve([]);
        return this.fetch('https://api.github.com/repos/'+o+'/'+r+'/contents/'+p).then(function(c){
            var f=[];
            var promises=[];
            c.forEach(function(i){
                if(i.type==='file'&&Parser.isCode(i.name))f.push({path:i.path,name:i.name,folder:i.path.includes('/')?i.path.substring(0,i.path.lastIndexOf('/')):'root',size:i.size});
                else if(i.type==='dir'&&!IGNORE.has(i.name)){if(cb)cb('/'+i.path);promises.push(self.scan(o,r,cb,i.path,d+1).catch(function(){return[];}));}
            });
            return Promise.all(promises).then(function(results){
                results.forEach(function(res){f=f.concat(res);});
                return f;
            });
        }).catch(function(e){if(d===0)throw e;return[];});
    }
};

function buildTree(files){
    var root={name:'root',path:'',children:{},files:[]};
    files.forEach(function(f){
        var parts=f.folder&&f.folder!=='root'?f.folder.split('/'):[];
        var cur=root;
        parts.forEach(function(p,i){
            var path=parts.slice(0,i+1).join('/');
            if(!cur.children[p])cur.children[p]={name:p,path:path,children:{},files:[]};
            cur=cur.children[p];
        });
        cur.files.push(f);
    });
    return root;
}

function countFiles(n){return n.files.length+Object.values(n.children).reduce(function(s,c){return s+countFiles(c);},0);}

function calcBlast(fileId,conns,files){
    var affected=new Set();
    var queue=[fileId];
    var visited=new Set();
    var depth=0;
    var maxDepth=0;
    while(queue.length>0&&depth<5){
        var size=queue.length;
        for(var i=0;i<size;i++){
            var cur=queue.shift();
            if(visited.has(cur))continue;
            visited.add(cur);
            conns.forEach(function(c){
                var src=typeof c.source==='object'?c.source.id:c.source;
                var tgt=typeof c.target==='object'?c.target.id:c.target;
                if(src===cur&&!visited.has(tgt)){affected.add(tgt);queue.push(tgt);maxDepth=depth+1;}
                if(tgt===cur&&!visited.has(src)){affected.add(src);queue.push(src);maxDepth=depth+1;}
            });
        }
        depth++;
    }
    var cnt=affected.size;
    var pct=files.length>0?Math.round(cnt/files.length*100):0;
    var level='low';
    if(pct>30)level='critical';else if(pct>20)level='high';else if(pct>10)level='medium';
    return{affected:Array.from(affected),count:cnt,percent:pct,level:level,depth:maxDepth};
}

function calcHealth(data){
    if(!data)return{score:0,grade:'F'};
    var score=100;
    var deadPct=data.stats.functions>0?(data.stats.dead/data.stats.functions*100):0;
    score-=Math.min(20,deadPct);
    var circular=data.issues.filter(function(i){return i.title.includes('Circular');}).length;
    score-=Math.min(20,circular*5);
    var god=data.issues.filter(function(i){return i.title.includes('Large');}).length;
    score-=Math.min(15,god*3);
    var avgCoup=data.stats.files>0?(data.stats.connections/data.stats.files):0;
    score-=Math.min(15,Math.max(0,avgCoup-3)*2);
    var sec=data.securityIssues?data.securityIssues.filter(function(i){return i.severity==='high';}).length:0;
    score-=Math.min(20,sec*5);
    score=Math.max(0,Math.round(score));
    var grade='F';
    if(score>=90)grade='A';else if(score>=80)grade='B';else if(score>=70)grade='C';else if(score>=60)grade='D';
    return{score:score,grade:grade};
}

function TreeNode(props){
    var node=props.node,selected=props.selected,onSelect=props.onSelect,expanded=props.expanded,toggle=props.toggle,filterFolder=props.filterFolder,activeFilter=props.activeFilter;
    var isOpen=expanded.has(node.path);
    var isFiltered=activeFilter===node.path;
    var children=Object.values(node.children).sort(function(a,b){return a.name.localeCompare(b.name);});
    return React.createElement('div',null,
        React.createElement('div',{className:'tree-folder'+(isFiltered?' filtered':''),onClick:function(){if(node.path==='')filterFolder(null);else filterFolder(node.path);}},
            React.createElement('span',{className:'tree-toggle'+(isOpen?' open':''),onClick:function(e){e.stopPropagation();toggle(node.path);}},children.length>0||node.files.length>0?'â–¶':''),
            React.createElement('span',null,isOpen?'ðŸ“‚':'ðŸ“'),
            React.createElement('span',{className:'tree-name'},node.name),
            React.createElement('span',{className:'tree-count'},countFiles(node))
        ),
        isOpen&&React.createElement('div',{className:'tree-children'},
            children.map(function(c){return React.createElement(TreeNode,{key:c.path,node:c,selected:selected,onSelect:onSelect,expanded:expanded,toggle:toggle,filterFolder:filterFolder,activeFilter:activeFilter});}),
            node.files.map(function(f){return React.createElement('div',{key:f.path,className:'tree-file'+(selected&&selected.path===f.path?' active':''),onClick:function(){onSelect(f.path);}},React.createElement('span',null,'ðŸ“„'),React.createElement('span',{className:'tree-name'},f.name));})
        )
    );
}

function HealthRing(props){
    var score=props.score,grade=props.grade;
    var circ=2*Math.PI*18;
    var offset=circ-(score/100)*circ;
    var color=score>=80?'var(--green)':score>=60?'var(--orange)':'var(--red)';
    return React.createElement('div',{className:'health-ring'},
        React.createElement('svg',{width:'48',height:'48'},
            React.createElement('circle',{cx:'24',cy:'24',r:'18',fill:'none',stroke:'var(--bg3)',strokeWidth:'4'}),
            React.createElement('circle',{cx:'24',cy:'24',r:'18',fill:'none',stroke:color,strokeWidth:'4',strokeDasharray:circ,strokeDashoffset:offset,strokeLinecap:'round'})
        ),
        React.createElement('div',{className:'health-ring-value',style:{color:color}},grade)
    );
}

function App(){
    var _a=useState(window.matchMedia('(prefers-color-scheme: light)').matches?'light':'dark'),theme=_a[0],setTheme=_a[1];
    var _b=useState(''),repoUrl=_b[0],setRepoUrl=_b[1];
    var _c=useState(''),token=_c[0],setToken=_c[1];
    var _d=useState(false),loading=_d[0],setLoading=_d[1];
    var _e=useState(''),progress=_e[0],setProgress=_e[1];
    var _f=useState(null),error=_f[0],setError=_f[1];
    var _g=useState(null),data=_g[0],setData=_g[1];
    var _h=useState(null),repoInfo=_h[0],setRepoInfo=_h[1];
    var _i=useState('folder'),colorMode=_i[0],setColorMode=_i[1];
    var _j=useState(null),selected=_j[0],setSelected=_j[1];
    var _k=useState(new Set([''])),expandedPaths=_k[0],setExpandedPaths=_k[1];
    var _l=useState(new Set(['blast','fns'])),expandedCards=_l[0],setExpandedCards=_l[1];
    var _m=useState('details'),rightTab=_m[0],setRightTab=_m[1];
    var _n=useState(null),blastRadius=_n[0],setBlastRadius=_n[1];
    var _o=useState(null),ownership=_o[0],setOwnership=_o[1];
    var _p=useState(''),prUrl=_p[0],setPrUrl=_p[1];
    var _q=useState(null),prData=_q[0],setPrData=_q[1];
    var _r=useState(false),showExport=_r[0],setShowExport=_r[1];
    var _s=useState(false),showPR=_s[0],setShowPR=_s[1];
    var _t=useState(false),showPrivacy=_t[0],setShowPrivacy=_t[1];
    var _u=useState(null),tooltip=_u[0],setTooltip=_u[1];
    var _v=useState(null),toast=_v[0],setToast=_v[1];
    var _w=useState(false),ownerLoading=_w[0],setOwnerLoading=_w[1];
    var _x=useState(null),folderFilter=_x[0],setFolderFilter=_x[1];
    var _y=useState(new Set()),expandedFns=_y[0],setExpandedFns=_y[1];
    var _z=useState(false),showUnused=_z[0],setShowUnused=_z[1];
    var svgRef=useRef(null);
    var zoomRef=useRef(null);
    var simRef=useRef(null);
    var nodesRef=useRef(null);
    var linksRef=useRef(null);
    var selectFileRef=useRef(null);

    useEffect(function(){document.body.className=theme==='light'?'light':'';},[theme]);

    useEffect(function(){
        var params=new URLSearchParams(window.location.search);
        var repo=params.get('repo');
        if(repo&&repo.length<200&&!repo.includes('{')&&/^[a-zA-Z0-9_.\/-]+$/.test(repo)){
            setRepoUrl(repo);
            setTimeout(function(){var btn=document.getElementById('analyze-btn');if(btn)btn.click();},500);
        }
    },[]);

    function parseUrl(url){
        if(!url||typeof url!=='string')return null;
        url=url.trim();
        if(url.length>200||url.includes('{')|| url.includes('"'))return null;
        var m=url.match(/^(?:https?:\/\/)?(?:www\.)?github\.com\/([a-zA-Z0-9_.-]+)\/([a-zA-Z0-9_.-]+)/);
        if(m)return{owner:m[1],repo:m[2].replace(/\.git$/,'')};
        var simple=url.match(/^([a-zA-Z0-9_.-]+)\/([a-zA-Z0-9_.-]+)$/);
        if(simple)return{owner:simple[1],repo:simple[2]};
        return null;
    }

    function analyze(){
        var p=parseUrl(repoUrl);
        if(!p){setError('Invalid URL. Use format: owner/repo');return;}
        setError(null);setData(null);setSelected(null);setBlastRadius(null);setLoading(true);setProgress('Scanning repository...');setFolderFilter(null);
        GitHub.token=token||null;
        setRepoInfo(p);

        GitHub.scan(p.owner,p.repo,setProgress).then(function(files){
            if(!files.length)throw new Error('No code files found');
            var max=Math.min(files.length,100);
            if(files.length>100)showNotification('Found '+files.length+' files. Analyzing first 100.','warning');
            var analyzed=[];
            var allFns=[];

            function processFile(i){
                if(i>=max){finishAnalysis();return;}
                var f=files[i];
                setProgress('Analyzing '+(i+1)+'/'+max+': '+f.name);
                Promise.all([
                    GitHub.getFile(p.owner,p.repo,f.path),
                    GitHub.getCommits(p.owner,p.repo,f.path,10).catch(function(){return[];})
                ]).then(function(results){
                    var content=results[0];
                    var commits=results[1];
                    if(content){
                        var fns=Parser.extract(content,f.path);
                        var layer=Parser.detectLayer(f.path);
                        analyzed.push({path:f.path,name:f.name,folder:f.folder,content:content,functions:fns,lines:content.split('\n').length,layer:layer,churn:Array.isArray(commits)?commits.length:0});
                        fns.forEach(function(fn){allFns.push(Object.assign({},fn,{folder:f.folder,layer:layer}));});
                    }
                    processFile(i+1);
                }).catch(function(){processFile(i+1);});
            }

            function finishAnalysis(){
                setProgress('Building dependency graph...');
                var fnNames=[...new Set(allFns.map(function(f){return f.name;}))];
                var conns=[];
                var fnStats={};
                allFns.forEach(function(fn){if(!fnStats[fn.name])fnStats[fn.name]={count:0,callers:new Map(),file:fn.file,folder:fn.folder,line:fn.line,code:fn.code};});
                analyzed.forEach(function(file){
                    var calls=Parser.findCalls(file.content,fnNames);
                    Object.entries(calls).forEach(function(entry){
                        var fn=entry[0],cnt=entry[1];
                        var def=fnStats[fn]?fnStats[fn].file:null;
                        if(def&&def!==file.path){
                            conns.push({source:def,target:file.path,fn:fn,count:cnt});
                            var ex=fnStats[fn].callers.get(file.path);
                            if(ex)ex.count+=cnt;else fnStats[fn].callers.set(file.path,{file:file.path,name:file.name,count:cnt});
                            fnStats[fn].count+=cnt;
                        }
                    });
                });
                Object.values(fnStats).forEach(function(s){s.callers=Array.from(s.callers.values());});
                var issues=[];
                var deadFns=Object.entries(fnStats).filter(function(x){return x[1].count===0;});
                if(deadFns.length)issues.push({type:'warning',title:deadFns.length+' Unused Functions',desc:'Functions not called from other files',items:deadFns.slice(0,10).map(function(x){return{name:x[0],file:x[1].file};})});
                var godFiles=analyzed.filter(function(f){return f.functions.length>15;});
                if(godFiles.length)issues.push({type:'critical',title:godFiles.length+' Large Files',desc:'Files with 15+ functions',items:godFiles.slice(0,5).map(function(f){return{name:f.name+' ('+f.functions.length+' fns)',file:f.path};})});
                var coupling={};
                conns.forEach(function(c){coupling[c.target]=(coupling[c.target]||0)+1;});
                var highCoup=Object.entries(coupling).filter(function(x){return x[1]>8;});
                if(highCoup.length)issues.push({type:'warning',title:highCoup.length+' Highly Coupled',desc:'Files imported by 8+ others',items:highCoup.slice(0,5).map(function(x){return{name:x[0].split('/').pop()+' ('+x[1]+' imports)',file:x[0]};})});
                var connSet=new Set(conns.map(function(c){return c.source+'|'+c.target;}));
                var circular=[];
                conns.forEach(function(c){if(connSet.has(c.target+'|'+c.source)){var key=[c.source,c.target].sort().join('|');if(!circular.includes(key))circular.push(key);}});
                if(circular.length)issues.push({type:'critical',title:circular.length+' Circular Dependencies',desc:'Files that import each other',items:circular.slice(0,5).map(function(p){return{name:p.split('|').map(function(x){return x.split('/').pop();}).join(' â†” ')};})});
                var patterns=Parser.detectPatterns(analyzed);
                var securityIssues=Parser.detectSecurity(analyzed);
                var folders=[...new Set(analyzed.map(function(f){return f.folder;}))].sort();
                var tree=buildTree(analyzed);
                setData({files:analyzed,functions:allFns,connections:conns,fnStats:fnStats,folders:folders,tree:tree,issues:issues,patterns:patterns,securityIssues:securityIssues,deadFunctions:deadFns.map(function(x){return{name:x[0],file:x[1].file,folder:x[1].folder,line:x[1].line,code:x[1].code};}),stats:{files:analyzed.length,functions:allFns.length,connections:conns.length,dead:deadFns.length,patterns:patterns.length,security:securityIssues.filter(function(i){return i.severity==='high';}).length}});
                setExpandedPaths(new Set(['']));
                var newUrl=window.location.pathname+'?repo='+encodeURIComponent(p.owner+'/'+p.repo);
                window.history.replaceState({},'',newUrl);
                setLoading(false);
            }

            processFile(0);
        }).catch(function(e){setError(e.message);setLoading(false);});
    }

    var selectFile=useCallback(function(path){
        if(!data)return;
        var file=data.files.find(function(f){return f.path===path;});
        if(file){
            setSelected(file);
            setRightTab('details');
            var blast=calcBlast(path,data.connections,data.files);
            setBlastRadius(blast);
            setOwnership(null);
            setExpandedFns(new Set());
            if(repoInfo){
                setOwnerLoading(true);
                GitHub.getBlame(repoInfo.owner,repoInfo.repo,path).then(function(owners){setOwnership(owners);setOwnerLoading(false);}).catch(function(){setOwnerLoading(false);});
            }
            updateGraphHighlight(path,blast);
        }
    },[data,repoInfo]);
    selectFileRef.current=selectFile;

    function updateGraphHighlight(path,blast){
        if(!nodesRef.current||!linksRef.current)return;
        var affectedSet=new Set(blast?blast.affected:[]);
        nodesRef.current.selectAll('.nc').transition().duration(200)
            .attr('opacity',function(n){if(n.id===path)return 1;if(affectedSet.has(n.id))return 1;return path?0.2:1;})
            .attr('fill',function(n){if(n.id===path)return'#ff5f5f';if(affectedSet.has(n.id))return'#ff9f43';return getNodeColor(n);});
        linksRef.current.transition().duration(200)
            .attr('stroke-opacity',function(l){var src=l.source.id||l.source;var tgt=l.target.id||l.target;if(src===path||tgt===path)return 0.8;return path?0.05:0.4;})
            .attr('stroke',function(l){var src=l.source.id||l.source;var tgt=l.target.id||l.target;if(src===path||tgt===path)return'var(--acc)';return theme==='light'?'#ccc':'#333';});
    }

    function getNodeColor(d){
        if(colorMode==='folder')return colorMap[d.folder]||COLORS[0];
        if(colorMode==='layer')return LAYER_COLORS[d.layer]||COLORS[0];
        if(colorMode==='churn')return colorMap[d.id]||'#22c55e';
        return COLORS[0];
    }

    var togglePath=useCallback(function(p){setExpandedPaths(function(prev){var n=new Set(prev);if(n.has(p))n.delete(p);else n.add(p);return n;});},[]);
    var toggleCard=useCallback(function(id){setExpandedCards(function(prev){var n=new Set(prev);if(n.has(id))n.delete(id);else n.add(id);return n;});},[]);
    var toggleFn=useCallback(function(name){setExpandedFns(function(prev){var n=new Set(prev);if(n.has(name))n.delete(name);else n.add(name);return n;});},[]);

    var colorMap=useMemo(function(){
        if(!data)return{};
        var m={};
        if(colorMode==='folder'){data.folders.forEach(function(f,i){m[f]=COLORS[i%COLORS.length];});m['root']=COLORS[0];}
        else if(colorMode==='layer')data.files.forEach(function(f){m[f.path]=LAYER_COLORS[f.layer]||COLORS[0];});
        else if(colorMode==='churn'){
            var maxC=Math.max.apply(null,data.files.map(function(f){return f.churn||0;}))||1;
            data.files.forEach(function(f){var r=(f.churn||0)/maxC;m[f.path]=r>0.7?'#ff5f5f':r>0.4?'#ff9f43':'#22c55e';});
        }
        return m;
    },[data,colorMode]);

    useEffect(function(){
        if(!data||!svgRef.current)return;
        var svg=d3.select(svgRef.current);
        svg.selectAll('*').remove();
        var w=svgRef.current.clientWidth;
        var h=svgRef.current.clientHeight;
        var filteredFiles=folderFilter?data.files.filter(function(f){return f.folder===folderFilter||f.folder.startsWith(folderFilter+'/');}):data.files;
        var fileIds=new Set(filteredFiles.map(function(f){return f.path;}));
        var nodes=filteredFiles.map(function(f){return{id:f.path,name:f.name,folder:f.folder,fnCount:f.functions.length,layer:f.layer,churn:f.churn||0};});
        var linkMap=new Map();
        data.connections.forEach(function(c){
            if(!fileIds.has(c.source)||!fileIds.has(c.target))return;
            var k=c.source+'|'+c.target;
            if(!linkMap.has(k))linkMap.set(k,{source:c.source,target:c.target,count:0});
            linkMap.get(k).count+=c.count;
        });
        var links=Array.from(linkMap.values());
        function getR(d){return Math.max(8,Math.min(24,5+d.fnCount*0.8));}
        function getC(d){
            if(colorMode==='folder')return colorMap[d.folder]||COLORS[0];
            if(colorMode==='layer')return LAYER_COLORS[d.layer]||COLORS[0];
            if(colorMode==='churn')return colorMap[d.id]||'#22c55e';
            return COLORS[0];
        }
        var folders=[...new Set(nodes.map(function(n){return n.folder;}))];
        var cols=Math.max(2,Math.ceil(Math.sqrt(folders.length)));
        var cw=w/(cols+1);
        var ch=h/(Math.ceil(folders.length/cols)+1);
        var centers={};
        folders.forEach(function(f,i){centers[f]={x:(i%cols+1)*cw,y:(Math.floor(i/cols)+1)*ch};});
        var zoom=d3.zoom().scaleExtent([0.2,5]).on('zoom',function(e){container.attr('transform',e.transform);});
        svg.call(zoom);
        zoomRef.current=zoom;
        var container=svg.append('g');
        var defs=svg.append('defs');
        defs.append('marker').attr('id','arr').attr('viewBox','0 -5 10 10').attr('refX',14).attr('markerWidth',4).attr('markerHeight',4).attr('orient','auto').append('path').attr('d','M0,-4L10,0L0,4').attr('fill',theme==='light'?'#aaa':'#444');
        var hullLayer=container.append('g');
        var linkLayer=container.append('g');
        var nodeLayer=container.append('g');
        var sim=d3.forceSimulation(nodes)
            .force('link',d3.forceLink(links).id(function(d){return d.id;}).distance(70).strength(0.3))
            .force('charge',d3.forceManyBody().strength(-200).distanceMax(200))
            .force('collision',d3.forceCollide().radius(function(d){return getR(d)+8;}))
            .force('x',d3.forceX(function(d){return centers[d.folder]?centers[d.folder].x:w/2;}).strength(0.3))
            .force('y',d3.forceY(function(d){return centers[d.folder]?centers[d.folder].y:h/2;}).strength(0.3))
            .velocityDecay(0.6).alphaDecay(0.05);
        simRef.current=sim;
        var link=linkLayer.selectAll('path').data(links).join('path').attr('fill','none').attr('stroke',theme==='light'?'#ccc':'#333').attr('stroke-width',function(d){return Math.max(1,Math.min(2,Math.sqrt(d.count)*0.3));}).attr('stroke-opacity',0.4).attr('marker-end','url(#arr)');
        linksRef.current=link;
        var node=nodeLayer.selectAll('g').data(nodes).join('g').style('cursor','pointer');
        nodesRef.current=node;
        node.call(d3.drag().on('start',function(e,d){if(!e.active)sim.alphaTarget(0.1).restart();d.fx=d.x;d.fy=d.y;}).on('drag',function(e,d){d.fx=e.x;d.fy=e.y;}).on('end',function(e,d){if(!e.active)sim.alphaTarget(0);d.fx=null;d.fy=null;}));
        node.on('click',function(e,d){e.stopPropagation();if(selectFileRef.current)selectFileRef.current(d.id);});
        node.on('mouseenter',function(e,d){var r=svgRef.current.getBoundingClientRect();setTooltip({x:e.clientX-r.left+10,y:e.clientY-r.top,title:d.name,content:d.fnCount+' functions\n'+d.layer+' layer\n'+d.churn+' recent commits'});}).on('mouseleave',function(){setTooltip(null);});
        svg.on('click',function(e){if(e.target===svgRef.current){setSelected(null);setBlastRadius(null);link.attr('stroke',theme==='light'?'#ccc':'#333').attr('stroke-opacity',0.4);node.selectAll('.nc').attr('opacity',1).attr('fill',getC);}});
        node.append('circle').attr('class','nc').attr('r',getR).attr('fill',getC).attr('stroke',function(d){var c=d3.color(getC(d));return c?c.brighter(0.3):'#fff';}).attr('stroke-width',1.5);
        node.append('text').attr('text-anchor','middle').attr('dy',0).attr('fill',theme==='light'?'#333':'#eee').attr('font-size',function(d){return Math.max(6,Math.min(10,getR(d)*0.6))+'px';}).attr('font-family','JetBrains Mono').attr('font-weight','500').attr('pointer-events','none').text(function(d){var n=d.name.replace(/\.[^.]+$/,'');var maxLen=Math.max(4,Math.floor(getR(d)/2));return n.length>maxLen+1?n.slice(0,maxLen)+'â€¦':n;});
        function updateHulls(){
            hullLayer.selectAll('*').remove();
            folders.forEach(function(f){
                var fn=nodes.filter(function(n){return n.folder===f;});
                if(fn.length<1)return;
                var pad=30,pts=[];
                fn.forEach(function(n){if(n.x&&n.y)pts.push([n.x-pad,n.y-pad],[n.x+pad,n.y-pad],[n.x-pad,n.y+pad],[n.x+pad,n.y+pad]);});
                if(pts.length<3)return;
                var hull=d3.polygonHull(pts);
                if(hull){
                    var color=colorMap[f]||COLORS[folders.indexOf(f)%COLORS.length];
                    hullLayer.append('path').attr('d','M'+hull.join('L')+'Z').attr('fill',color).attr('fill-opacity',0.04).attr('stroke',color).attr('stroke-width',2).attr('stroke-opacity',0.25).attr('rx',8);
                    var cx=d3.mean(fn,function(n){return n.x;}),cy=d3.min(fn,function(n){return n.y;})-pad-8;
                    hullLayer.append('text').attr('x',cx).attr('y',cy).attr('text-anchor','middle').attr('fill',color).attr('font-size','10px').attr('font-family','JetBrains Mono').attr('font-weight','600').attr('opacity',0.7).text(f||'root');
                }
            });
        }
        sim.on('tick',function(){link.attr('d',function(d){var dx=d.target.x-d.source.x,dy=d.target.y-d.source.y,dr=Math.sqrt(dx*dx+dy*dy);return'M'+d.source.x+','+d.source.y+'A'+dr+','+dr+' 0 0,1 '+d.target.x+','+d.target.y;});node.attr('transform',function(d){return'translate('+d.x+','+d.y+')';});updateHulls();});
        return function(){sim.stop();};
    },[data,colorMap,colorMode,theme,folderFilter]);

    function zoomIn(){if(zoomRef.current&&svgRef.current)d3.select(svgRef.current).transition().duration(200).call(zoomRef.current.scaleBy,1.4);}
    function zoomOut(){if(zoomRef.current&&svgRef.current)d3.select(svgRef.current).transition().duration(200).call(zoomRef.current.scaleBy,0.7);}
    function resetZoom(){if(zoomRef.current&&svgRef.current)d3.select(svgRef.current).transition().duration(300).call(zoomRef.current.transform,d3.zoomIdentity);}
    function fitView(){
        if(!zoomRef.current||!svgRef.current||!simRef.current)return;
        var nodes=simRef.current.nodes();
        if(!nodes.length)return;
        var xs=nodes.map(function(n){return n.x;}),ys=nodes.map(function(n){return n.y;});
        var minX=Math.min.apply(null,xs),maxX=Math.max.apply(null,xs),minY=Math.min.apply(null,ys),maxY=Math.max.apply(null,ys);
        var w=svgRef.current.clientWidth,h=svgRef.current.clientHeight;
        var scale=0.8/Math.max((maxX-minX+100)/w,(maxY-minY+100)/h);
        d3.select(svgRef.current).transition().duration(400).call(zoomRef.current.transform,d3.zoomIdentity.translate(w/2-scale*(minX+maxX)/2,h/2-scale*(minY+maxY)/2).scale(Math.min(scale,2)));
    }
    function exportSVG(){if(!svgRef.current)return;var svgClone=svgRef.current.cloneNode(true);svgClone.setAttribute('xmlns','http://www.w3.org/2000/svg');svgClone.setAttribute('width',svgRef.current.clientWidth);svgClone.setAttribute('height',svgRef.current.clientHeight);var style=document.createElementNS('http://www.w3.org/2000/svg','style');style.textContent='text{font-family:JetBrains Mono,monospace;pointer-events:none}';svgClone.insertBefore(style,svgClone.firstChild);var blob=new Blob([new XMLSerializer().serializeToString(svgClone)],{type:'image/svg+xml'});var url=URL.createObjectURL(blob);var a=document.createElement('a');a.href=url;a.download='codeflow-'+Date.now()+'.svg';a.click();URL.revokeObjectURL(url);}
    function exportJSON(){if(!data)return;var blob=new Blob([JSON.stringify({stats:data.stats,files:data.files.map(function(f){return{path:f.path,fns:f.functions.length,layer:f.layer,lines:f.lines};}),connections:data.connections,issues:data.issues,patterns:data.patterns,security:data.securityIssues},null,2)],{type:'application/json'});var url=URL.createObjectURL(blob);var a=document.createElement('a');a.href=url;a.download='codeflow-analysis.json';a.click();}
    function showNotification(msg,type){setToast({msg:msg,type:type||'success'});setTimeout(function(){setToast(null);},3000);}
    function copyLink(){navigator.clipboard.writeText(window.location.href).then(function(){showNotification('Link copied to clipboard!');}).catch(function(){showNotification('Failed to copy link','error');});}
    function analyzePR(){if(!prUrl||!repoInfo)return;var m=prUrl.match(/\/pull\/(\d+)/);if(!m){showNotification('Invalid PR URL','error');return;}GitHub.getPR(repoInfo.owner,repoInfo.repo,m[1]).then(function(pr){if(pr)setPrData(pr);else showNotification('Could not load PR','error');});}
    function resetAnalysis(){setData(null);setSelected(null);setBlastRadius(null);setOwnership(null);setRepoInfo(null);setRepoUrl('');setPrData(null);setFolderFilter(null);window.history.replaceState({},'',window.location.pathname);}
    function filterByFolder(path){setFolderFilter(folderFilter===path?null:path);}
    var health=useMemo(function(){return calcHealth(data);},[data]);

    return React.createElement('div',{className:'app'},
        React.createElement('div',{className:'topbar'},
            React.createElement('div',{className:'logo',onClick:function(){setShowPrivacy(true);}},
                React.createElement('div',{className:'logo-mark'},'âš¡'),
                React.createElement('span',{className:'logo-text'},'CODEFLOW')
            ),
            React.createElement('div',{className:'repo-input-group'},
                React.createElement('input',{className:'repo-input','aria-label':'Repository URL',placeholder:'owner/repo or GitHub URL',value:repoUrl,onChange:function(e){setRepoUrl(e.target.value);},onKeyDown:function(e){if(e.key==='Enter'&&!loading)analyze();}}),
                React.createElement('input',{className:'repo-input',type:'password','aria-label':'GitHub Token',placeholder:'Token (optional)',value:token,onChange:function(e){setToken(e.target.value);},onKeyDown:function(e){if(e.key==='Enter'&&!loading)analyze();},style:{maxWidth:120}}),
                React.createElement('button',{id:'analyze-btn',className:'top-btn primary','aria-label':'Analyze repository',onClick:analyze,disabled:loading||!repoUrl},loading?'â³':'ðŸ”',' Analyze'),
                data&&React.createElement('button',{className:'reset-btn','aria-label':'Reset analysis',onClick:resetAnalysis,title:'Clear & Reset'},'âœ• Reset')
            ),
            React.createElement('div',{className:'topbar-actions'},
                React.createElement('button',{className:'top-btn','aria-label':'Analyze Pull Request',onClick:function(){setShowPR(true);},disabled:!data},'ðŸ“Š PR'),
                React.createElement('button',{className:'top-btn','aria-label':'Export analysis',onClick:function(){setShowExport(true);},disabled:!data},'ðŸ“¤'),
                React.createElement('button',{className:'top-btn','aria-label':'Copy share link',onClick:copyLink,disabled:!data},'ðŸ”—'),
                React.createElement('button',{className:'top-btn','aria-label':'Toggle theme',onClick:function(){setTheme(function(t){return t==='dark'?'light':'dark';});}},theme==='dark'?'â˜€ï¸':'ðŸŒ™')
            )
        ),
        React.createElement('div',{className:'main'},
            React.createElement('div',{className:'sidebar'},
                data?React.createElement(React.Fragment,null,
                    React.createElement('div',{className:'sidebar-section'},
                        React.createElement('div',{className:'health-score'},
                            React.createElement(HealthRing,{score:health.score,grade:health.grade}),
                            React.createElement('div',{className:'health-info'},
                                React.createElement('div',{className:'health-grade',style:{color:health.score>=80?'var(--green)':health.score>=60?'var(--orange)':'var(--red)'}},health.score,'/100'),
                                React.createElement('div',{className:'health-label'},'Health Score')
                            )
                        )
                    ),
                    React.createElement('div',{className:'sidebar-section'},
                        React.createElement('div',{className:'sidebar-title'},'Color By'),
                        React.createElement('div',{className:'view-modes'},
                            React.createElement('div',{className:'view-mode'+(colorMode==='folder'?' active':''),onClick:function(){setColorMode('folder');}},React.createElement('span',{className:'view-mode-icon'},'ðŸ“'),'Folder'),
                            React.createElement('div',{className:'view-mode'+(colorMode==='layer'?' active':''),onClick:function(){setColorMode('layer');}},React.createElement('span',{className:'view-mode-icon'},'ðŸ—ï¸'),'Layer'),
                            React.createElement('div',{className:'view-mode'+(colorMode==='churn'?' active':''),onClick:function(){setColorMode('churn');}},React.createElement('span',{className:'view-mode-icon'},'ðŸ”¥'),'Churn')
                        )
                    ),
                    React.createElement('div',{className:'sidebar-section'},
                        React.createElement('div',{className:'stats-grid'},
                            React.createElement('div',{className:'stat-card'},React.createElement('div',{className:'stat-value'},data.stats.files),React.createElement('div',{className:'stat-label'},'Files')),
                            React.createElement('div',{className:'stat-card'},React.createElement('div',{className:'stat-value'},data.stats.functions),React.createElement('div',{className:'stat-label'},'Functions')),
                            React.createElement('div',{className:'stat-card'},React.createElement('div',{className:'stat-value'},data.stats.connections),React.createElement('div',{className:'stat-label'},'Links')),
                            React.createElement('div',{className:'stat-card'+(data.stats.dead>10?' warn':''),style:{cursor:data.stats.dead>0?'pointer':'default'},onClick:function(){if(data.stats.dead>0)setShowUnused(true);}},React.createElement('div',{className:'stat-value'},data.stats.dead),React.createElement('div',{className:'stat-label'},'Unused'))
                        )
                    ),
                    React.createElement('div',{className:'sidebar-section',style:{paddingBottom:8}},
                        React.createElement('div',{className:'sidebar-title'},'Explorer'),
                        folderFilter&&React.createElement('button',{className:'top-btn',style:{width:'100%',marginTop:8},onClick:function(){setFolderFilter(null);}},'âœ• Clear Filter: ',folderFilter)
                    ),
                    React.createElement('div',{className:'sidebar-scroll'},React.createElement(TreeNode,{node:data.tree,selected:selected,onSelect:selectFile,expanded:expandedPaths,toggle:togglePath,filterFolder:filterByFolder,activeFilter:folderFilter}))
                ):React.createElement('div',{className:'empty-state'},React.createElement('div',{className:'empty-icon'},'ðŸ”'),React.createElement('div',{className:'empty-title'},'No Repository'),React.createElement('div',{className:'empty-desc'},'Enter a GitHub URL to analyze'))
            ),
            React.createElement('div',{className:'canvas-area'},
                loading?React.createElement('div',{className:'loading'},React.createElement('div',{className:'spinner'}),React.createElement('div',{className:'loading-text'},'Analyzing...'),React.createElement('div',{className:'loading-progress'},progress)):
                !data?React.createElement('div',{className:'empty-state'},React.createElement('div',{className:'empty-icon'},'âš¡'),React.createElement('div',{className:'empty-title'},'CodeFlow'),React.createElement('div',{className:'empty-desc'},'Visualize architecture, blast radius, ownership, patterns & security')):
                React.createElement(React.Fragment,null,
                    React.createElement('svg',{ref:svgRef}),
                    React.createElement('div',{className:'canvas-toolbar'},
                        React.createElement('button',{className:'tool-btn',onClick:zoomIn,'aria-label':'Zoom in'},'+'),
                        React.createElement('button',{className:'tool-btn',onClick:zoomOut,'aria-label':'Zoom out'},'âˆ’'),
                        React.createElement('button',{className:'tool-btn',onClick:resetZoom,'aria-label':'Reset zoom'},'âŸ²'),
                        React.createElement('button',{className:'tool-btn',onClick:fitView,'aria-label':'Fit view'},'âŠ¡')
                    ),
                    React.createElement('div',{className:'canvas-info'},
                        React.createElement('div',{className:'info-chip'},React.createElement('strong',null,folderFilter?data.files.filter(function(f){return f.folder===folderFilter||f.folder.startsWith(folderFilter+'/');}).length:data.files.length),' files'),
                        React.createElement('div',{className:'info-chip'},React.createElement('strong',null,data.connections.length),' links'),
                        selected&&blastRadius&&React.createElement('div',{className:'info-chip'},'ðŸ’¥ ',React.createElement('strong',null,blastRadius.count),' affected')
                    ),
                    React.createElement('div',{className:'legend'},
                        React.createElement('div',{className:'legend-title'},colorMode==='folder'?'Folders':colorMode==='layer'?'Layers':'Churn'),
                        colorMode==='folder'&&data.folders.slice(0,12).map(function(f,i){return React.createElement('div',{key:f,className:'legend-item'+(folderFilter===f?' active':''),onClick:function(){filterByFolder(f);}},React.createElement('div',{className:'legend-color',style:{background:colorMap[f]||COLORS[i%COLORS.length]}}),f||'root');}),
                        colorMode==='folder'&&data.folders.length>12&&React.createElement('div',{style:{fontSize:9,color:'var(--t3)',marginTop:4}},'+',data.folders.length-12,' more'),
                        colorMode==='layer'&&Object.entries(LAYER_COLORS).map(function(e){return React.createElement('div',{key:e[0],className:'legend-item'},React.createElement('div',{className:'legend-color',style:{background:e[1]}}),e[0]);}),
                        colorMode==='churn'&&React.createElement(React.Fragment,null,React.createElement('div',{className:'legend-item'},React.createElement('div',{className:'legend-color',style:{background:'#ff5f5f'}}),'High (7+ commits)'),React.createElement('div',{className:'legend-item'},React.createElement('div',{className:'legend-color',style:{background:'#ff9f43'}}),'Medium (4-6)'),React.createElement('div',{className:'legend-item'},React.createElement('div',{className:'legend-color',style:{background:'#22c55e'}}),'Low (0-3)'))
                    ),
                    tooltip&&React.createElement('div',{className:'tooltip',style:{left:tooltip.x,top:tooltip.y}},React.createElement('div',{className:'tooltip-title'},tooltip.title),React.createElement('div',{className:'tooltip-content'},tooltip.content))
                )
            ),
            React.createElement('div',{className:'right-panel'},
                data?React.createElement(React.Fragment,null,
                    React.createElement('div',{className:'panel-tabs'},
                        React.createElement('button',{className:'panel-tab'+(rightTab==='details'?' active':''),onClick:function(){setRightTab('details');}},selected?'ðŸ“„ FILE':'ðŸ” ISSUES'),
                        React.createElement('button',{className:'panel-tab'+(rightTab==='patterns'?' active':''),onClick:function(){setRightTab('patterns');}},'ðŸ§© PATTERNS ',React.createElement('span',{className:'badge badge-default'},data.patterns.length)),
                        React.createElement('button',{className:'panel-tab'+(rightTab==='security'?' active':''),onClick:function(){setRightTab('security');}},'ðŸ” SECURITY',data.stats.security>0&&React.createElement('span',{className:'view-mode-badge',style:{marginLeft:4}},data.stats.security))
                    ),
                    React.createElement('div',{className:'panel-content'},
                        rightTab==='details'&&(selected?React.createElement(React.Fragment,null,
                            React.createElement('button',{className:'top-btn',style:{width:'100%',marginBottom:12},onClick:function(){setSelected(null);setBlastRadius(null);if(nodesRef.current){nodesRef.current.selectAll('.nc').transition().duration(200).attr('opacity',1).attr('fill',getNodeColor);}if(linksRef.current){linksRef.current.transition().duration(200).attr('stroke-opacity',0.4).attr('stroke',theme==='light'?'#ccc':'#333');}}},'â† Back to Issues'),
                            React.createElement('div',{className:'panel-header',style:{margin:'-12px -12px 12px',padding:12}},React.createElement('div',{className:'panel-title'},'ðŸ“„ ',selected.name),React.createElement('div',{className:'panel-subtitle'},selected.folder||'root',' â€¢ ',selected.layer,' â€¢ ',selected.lines,' lines')),
                            blastRadius&&React.createElement('div',{className:'card',style:{marginBottom:12}},
                                React.createElement('div',{className:'card-header',onClick:function(){toggleCard('blast');}},React.createElement('div',{className:'card-title'},React.createElement('span',{className:'card-toggle'+(expandedCards.has('blast')?' open':'')},'â–¶'),'ðŸ’¥ Blast Radius'),React.createElement('span',{className:'badge badge-'+(blastRadius.level==='low'?'success':blastRadius.level==='medium'?'warning':'danger')},blastRadius.level.toUpperCase())),
                                expandedCards.has('blast')&&React.createElement('div',{className:'card-body'},
                                    React.createElement('div',{style:{marginBottom:8}},React.createElement('div',{style:{display:'flex',justifyContent:'space-between',fontSize:10,marginBottom:4}},React.createElement('span',null,'Impact'),React.createElement('span',null,blastRadius.count,' files (',blastRadius.percent,'%)')),React.createElement('div',{className:'progress-bar'},React.createElement('div',{className:'progress-fill',style:{width:Math.min(100,blastRadius.percent)+'%',background:blastRadius.level==='low'?'var(--green)':blastRadius.level==='medium'?'var(--orange)':'var(--red)'}}))),
                                    React.createElement('div',{style:{fontSize:9,color:'var(--t3)',marginBottom:8}},'Changes to this file propagate up to ',blastRadius.depth,' levels deep'),
                                    blastRadius.affected.length>0&&React.createElement('div',{className:'blast-detail'},
                                        React.createElement('div',{style:{fontSize:9,fontWeight:600,marginBottom:6}},'Affected Files:'),
                                        blastRadius.affected.slice(0,10).map(function(path){return React.createElement('div',{key:path,className:'blast-file',onClick:function(){selectFile(path);}},'ðŸ“„ ',path.split('/').pop());}),
                                        blastRadius.affected.length>10&&React.createElement('div',{style:{fontSize:9,color:'var(--t3)',marginTop:4}},'+',blastRadius.affected.length-10,' more files')
                                    )
                                )
                            ),
                            React.createElement('div',{className:'card',style:{marginBottom:12}},
                                React.createElement('div',{className:'card-header',onClick:function(){toggleCard('own');}},React.createElement('div',{className:'card-title'},React.createElement('span',{className:'card-toggle'+(expandedCards.has('own')?' open':'')},'â–¶'),'ðŸ‘¥ Ownership')),
                                expandedCards.has('own')&&React.createElement('div',{className:'card-body'},
                                    ownerLoading?React.createElement('div',{className:'loading-owner'},'Loading ownership data...'):
                                    ownership&&ownership.length>0?React.createElement(React.Fragment,null,
                                        React.createElement('div',{className:'owner-bar'},ownership.slice(0,5).map(function(o,i){return React.createElement('div',{key:i,className:'owner-segment',style:{width:o.percent+'%',background:COLORS[i%COLORS.length]}});})),
                                        React.createElement('div',{className:'owner-list'},ownership.slice(0,5).map(function(o,i){return React.createElement('div',{key:i,className:'owner-item'},React.createElement('div',{className:'owner-avatar',style:{background:COLORS[i%COLORS.length]}},o.name[0].toUpperCase()),React.createElement('span',{className:'owner-name'},o.name),React.createElement('span',{className:'owner-percent'},o.percent,'%'));}))
                                    ):React.createElement('div',{style:{fontSize:10,color:'var(--t3)',padding:8}},'No ownership data available')
                                )
                            ),
                            React.createElement('div',{className:'card'},
                                React.createElement('div',{className:'card-header',onClick:function(){toggleCard('fns');}},React.createElement('div',{className:'card-title'},React.createElement('span',{className:'card-toggle'+(expandedCards.has('fns')?' open':'')},'â–¶'),'âš¡ Functions (',selected.functions.length,')')),
                                expandedCards.has('fns')&&React.createElement('div',{className:'card-body',style:{padding:8}},
                                    selected.functions.length===0?React.createElement('div',{style:{fontSize:10,color:'var(--t3)',padding:8,textAlign:'center'}},'No functions detected'):
                                    selected.functions.map(function(fn){
                                        var st=data.fnStats[fn.name];
                                        var isExpanded=expandedFns.has(fn.name);
                                        return React.createElement('div',{key:fn.name,className:'fn-item'},
                                            React.createElement('div',{className:'fn-header',onClick:function(){toggleFn(fn.name);}},
                                                React.createElement('span',{className:'fn-name'},fn.name,'()'),
                                                React.createElement('span',{style:{display:'flex',alignItems:'center',gap:6}},
                                                    React.createElement('span',{className:'fn-line'},'L',fn.line),
                                                    React.createElement('span',{className:'badge '+(st&&st.count>10?'badge-danger':st&&st.count>0?'badge-warning':'badge-default')},st?st.count:0,' calls')
                                                )
                                            ),
                                            isExpanded&&React.createElement(React.Fragment,null,
                                                fn.code&&React.createElement('div',{className:'fn-code'},fn.code),
                                                st&&st.callers&&st.callers.length>0&&React.createElement('div',{className:'fn-callers'},
                                                    React.createElement('div',{className:'fn-callers-title'},'Called from:'),
                                                    st.callers.slice(0,8).map(function(c,i){return React.createElement('div',{key:i,className:'fn-caller',onClick:function(){selectFile(c.file);}},
                                                        React.createElement('span',null,'ðŸ“„'),
                                                        React.createElement('span',null,c.name),
                                                        React.createElement('span',{style:{marginLeft:'auto',color:'var(--t3)'}},c.count,'Ã—')
                                                    );}),
                                                    st.callers.length>8&&React.createElement('div',{style:{fontSize:9,color:'var(--t3)',padding:'4px 6px'}},'+',st.callers.length-8,' more')
                                                ),
                                                (!st||!st.callers||st.callers.length===0)&&React.createElement('div',{style:{fontSize:9,color:'var(--t3)',padding:8,textAlign:'center'}},'No callers detected')
                                            )
                                        );
                                    })
                                )
                            )
                        ):React.createElement(React.Fragment,null,
                            React.createElement('div',{style:{fontSize:12,fontWeight:600,marginBottom:12}},'ðŸ” Architecture Issues (',data.issues.length,')'),
                            data.issues.length===0?React.createElement('div',{style:{textAlign:'center',padding:20}},React.createElement('div',{style:{fontSize:32,marginBottom:8}},'âœ¨'),React.createElement('div',{style:{color:'var(--green)'}},'No issues detected!')):
                            data.issues.map(function(issue,i){return React.createElement('div',{key:i,className:'security-item '+(issue.type==='critical'?'high':'medium')},
                                React.createElement('div',{className:'security-header'},
                                    React.createElement('span',null,issue.type==='critical'?'ðŸ”´':'ðŸŸ¡'),
                                    React.createElement('span',{className:'security-title'},issue.title)
                                ),
                                React.createElement('div',{className:'security-desc'},issue.desc),
                                issue.items&&issue.items.slice(0,5).map(function(item,j){return React.createElement('div',{key:j,className:'security-path',style:{cursor:'pointer'},onClick:function(){if(item.file)selectFile(item.file);}},item.name);})
                            );})
                        )),
                        rightTab==='patterns'&&React.createElement(React.Fragment,null,
                            React.createElement('div',{style:{fontSize:12,fontWeight:600,marginBottom:12}},'ðŸ§© Design Patterns & Anti-Patterns'),
                            data.patterns.length===0?React.createElement('div',{style:{textAlign:'center',padding:20,color:'var(--t3)'}},React.createElement('div',{style:{fontSize:32,marginBottom:8}},'ðŸ”'),React.createElement('div',null,'No patterns detected'),React.createElement('div',{style:{fontSize:10,marginTop:8}},'Patterns are detected based on code structure')):
                            data.patterns.map(function(p,i){return React.createElement('div',{key:i,className:'pattern-item'+(p.isAnti?' anti':'')},
                                React.createElement('div',{className:'pattern-header'},
                                    React.createElement('span',{className:'pattern-icon'},p.icon),
                                    React.createElement('span',{className:'pattern-name'},p.name),
                                    p.isAnti&&React.createElement('span',{className:'badge badge-danger',style:{marginLeft:8}},'Anti-pattern')
                                ),
                                React.createElement('div',{className:'pattern-desc'},p.desc),
                                React.createElement('div',{className:'pattern-files'},
                                    p.files.slice(0,5).map(function(f,j){return React.createElement('span',{key:j,className:'pattern-file',style:{cursor:'pointer'},onClick:function(){selectFile(f.path);}},f.name);})
                                ),
                                p.files.length>5&&React.createElement('div',{style:{fontSize:9,color:'var(--t3)',marginTop:4}},'+',p.files.length-5,' more files'),
                                p.metrics&&React.createElement('div',{className:'pattern-metrics'},
                                    Object.entries(p.metrics).map(function(e){return React.createElement('div',{key:e[0],className:'pattern-metric'},React.createElement('div',{className:'pattern-metric-value'},e[1]),React.createElement('div',{className:'pattern-metric-label'},e[0]));})
                                )
                            );})
                        ),
                        rightTab==='security'&&React.createElement(React.Fragment,null,
                            React.createElement('div',{style:{fontSize:12,fontWeight:600,marginBottom:12}},'ðŸ” Security Analysis'),
                            data.securityIssues.length===0?React.createElement('div',{style:{textAlign:'center',padding:20}},React.createElement('div',{style:{fontSize:32,marginBottom:8}},'âœ…'),React.createElement('div',{style:{color:'var(--green)',fontWeight:600}},'No security issues found!'),React.createElement('div',{style:{fontSize:10,color:'var(--t3)',marginTop:8}},'Your code passed all security checks')):
                            React.createElement(React.Fragment,null,
                                React.createElement('div',{style:{display:'flex',gap:8,marginBottom:12}},
                                    React.createElement('div',{className:'badge badge-danger'},data.securityIssues.filter(function(i){return i.severity==='high';}).length,' High'),
                                    React.createElement('div',{className:'badge badge-warning'},data.securityIssues.filter(function(i){return i.severity==='medium';}).length,' Medium'),
                                    React.createElement('div',{className:'badge badge-info'},data.securityIssues.filter(function(i){return i.severity==='low';}).length,' Low')
                                ),
                                data.securityIssues.map(function(issue,i){return React.createElement('div',{key:i,className:'security-item '+issue.severity,onClick:function(){selectFile(issue.path);}},
                                    React.createElement('div',{className:'security-header'},
                                        React.createElement('span',null,issue.severity==='high'?'ðŸ”´':issue.severity==='medium'?'ðŸŸ¡':'ðŸ”µ'),
                                        React.createElement('span',{className:'security-title'},issue.title)
                                    ),
                                    React.createElement('div',{className:'security-desc'},issue.desc),
                                    React.createElement('div',{className:'security-path'},issue.file,issue.line?' : Line '+issue.line:''),
                                    issue.code&&React.createElement('div',{className:'security-code'},issue.code)
                                );})
                            )
                        )
                    )
                ):React.createElement('div',{className:'empty-state'},React.createElement('div',{className:'empty-icon'},'ðŸ“Š'),React.createElement('div',{className:'empty-title'},'Analysis'),React.createElement('div',{className:'empty-desc'},'Analyze a repo to see insights'))
            )
        ),
        showExport&&React.createElement('div',{className:'modal-overlay',onClick:function(){setShowExport(false);}},
            React.createElement('div',{className:'modal',onClick:function(e){e.stopPropagation();}},
                React.createElement('div',{className:'modal-header'},React.createElement('div',{className:'modal-title'},'ðŸ“¤ Export'),React.createElement('button',{className:'modal-close',onClick:function(){setShowExport(false);}},'Ã—')),
                React.createElement('div',{className:'modal-body'},
                    React.createElement('div',{className:'export-options'},
                        React.createElement('div',{className:'export-option',onClick:function(){exportSVG();setShowExport(false);}},React.createElement('div',{className:'export-option-icon'},'ðŸ–¼ï¸'),React.createElement('div',{className:'export-option-label'},'SVG Image')),
                        React.createElement('div',{className:'export-option',onClick:function(){exportJSON();setShowExport(false);}},React.createElement('div',{className:'export-option-icon'},'ðŸ“‹'),React.createElement('div',{className:'export-option-label'},'JSON Data')),
                        React.createElement('div',{className:'export-option',onClick:function(){copyLink();setShowExport(false);}},React.createElement('div',{className:'export-option-icon'},'ðŸ”—'),React.createElement('div',{className:'export-option-label'},'Share Link'))
                    )
                )
            )
        ),
        showPR&&React.createElement('div',{className:'modal-overlay',onClick:function(){setShowPR(false);}},
            React.createElement('div',{className:'modal',onClick:function(e){e.stopPropagation();}},
                React.createElement('div',{className:'modal-header'},React.createElement('div',{className:'modal-title'},'ðŸ“Š PR Impact Analyzer'),React.createElement('button',{className:'modal-close',onClick:function(){setShowPR(false);}},'Ã—')),
                React.createElement('div',{className:'modal-body'},
                    React.createElement('div',{className:'form-group'},React.createElement('label',{className:'form-label'},'Pull Request URL'),React.createElement('input',{className:'form-input','aria-label':'Pull Request URL',placeholder:'https://github.com/owner/repo/pull/123',value:prUrl,onChange:function(e){setPrUrl(e.target.value);},onKeyDown:function(e){if(e.key==='Enter')analyzePR();}})),
                    React.createElement('button',{className:'top-btn primary','aria-label':'Analyze Pull Request',onClick:analyzePR,style:{marginBottom:16}},'ðŸ” Analyze Impact'),
                    prData&&React.createElement(React.Fragment,null,
                        React.createElement('div',{className:'pr-header'},React.createElement('div',{className:'pr-title'},prData.title),React.createElement('div',{className:'pr-stats'},React.createElement('span',{className:'pr-add'},'+',prData.additions||0,' additions'),React.createElement('span',{className:'pr-del'},'-',prData.deletions||0,' deletions'))),
                        React.createElement('div',{style:{fontSize:11,fontWeight:600,marginBottom:8}},'Impacted Files (',prData.files?prData.files.length:0,')'),
                        prData.files&&prData.files.slice(0,15).map(function(f,i){
                            var existing=data&&data.files.find(function(df){return df.path===f.filename;});
                            var blast=existing?calcBlast(f.filename,data.connections,data.files):null;
                            return React.createElement('div',{key:i,className:'pr-file'},React.createElement('span',{className:'pr-file-name',title:f.filename},f.filename),React.createElement('span',{className:'pr-file-impact',style:{background:blast?blast.level==='low'?'rgba(34,197,94,0.2)':blast.level==='medium'?'rgba(255,159,67,0.2)':'rgba(255,95,95,0.2)':'var(--bg3)',color:blast?blast.level==='low'?'var(--green)':blast.level==='medium'?'var(--orange)':'var(--red)':'var(--t3)'}},blast?blast.count+' affected':'new file'));
                        })
                    )
                )
            )
        ),
        showPrivacy&&React.createElement('div',{className:'modal-overlay',onClick:function(){setShowPrivacy(false);}},
            React.createElement('div',{className:'modal privacy-modal',onClick:function(e){e.stopPropagation();}},
                React.createElement('div',{className:'modal-header'},React.createElement('div',{className:'modal-title'},'ðŸ”’ Privacy & Security'),React.createElement('button',{className:'modal-close',onClick:function(){setShowPrivacy(false);}},'Ã—')),
                React.createElement('div',{className:'modal-body'},
                    React.createElement('div',{className:'privacy-item'},
                        React.createElement('div',{className:'privacy-icon'},'ðŸŒ'),
                        React.createElement('div',null,React.createElement('div',{className:'privacy-title'},'100% Browser-Based'),React.createElement('div',{className:'privacy-text'},'CodeFlow runs entirely in your browser. No backend servers, no data collection.'))
                    ),
                    React.createElement('div',{className:'privacy-item'},
                        React.createElement('div',{className:'privacy-icon'},'ðŸ”‘'),
                        React.createElement('div',null,React.createElement('div',{className:'privacy-title'},'Your Token Stays Local'),React.createElement('div',{className:'privacy-text'},'Your GitHub token is stored only in your browser\'s memory. It\'s never saved, logged, or transmitted anywhere except directly to GitHub\'s API.'))
                    ),
                    React.createElement('div',{className:'privacy-item'},
                        React.createElement('div',{className:'privacy-icon'},'ðŸ“¡'),
                        React.createElement('div',null,React.createElement('div',{className:'privacy-title'},'Direct API Calls'),React.createElement('div',{className:'privacy-text'},'All GitHub API calls go directly from your browser to api.github.com. We have no proxy, no middleware, no way to intercept your data.'))
                    ),
                    React.createElement('div',{className:'privacy-item'},
                        React.createElement('div',{className:'privacy-icon'},'ðŸ—‘ï¸'),
                        React.createElement('div',null,React.createElement('div',{className:'privacy-title'},'Nothing Persisted'),React.createElement('div',{className:'privacy-text'},'Close the tab and everything is gone. No cookies, no local storage, no tracking. Check the source code - it\'s all in one HTML file!'))
                    ),
                    React.createElement('div',{style:{marginTop:16,padding:12,background:'var(--accbg)',borderRadius:8,fontSize:10,color:'var(--t1)'}},
                        'ðŸ’¡ Tip: Create a ',React.createElement('a',{href:'https://github.com/settings/tokens',target:'_blank',rel:'noopener',style:{color:'var(--acc)'}},'Personal Access Token'),' with only "public_repo" scope for extra peace of mind when analyzing public repositories.'
                    )
                ),
                React.createElement('div',{className:'modal-footer'},
                    React.createElement('button',{className:'top-btn primary',onClick:function(){setShowPrivacy(false);}},'Got it!')
                )
            )
        ),
        showUnused&&data&&data.deadFunctions&&React.createElement('div',{className:'modal-overlay',onClick:function(){setShowUnused(false);}},
            React.createElement('div',{className:'modal',style:{maxWidth:550,maxHeight:'80vh'},onClick:function(e){e.stopPropagation();}},
                React.createElement('div',{className:'modal-header'},React.createElement('div',{className:'modal-title'},'âš ï¸ Unused Functions (',data.deadFunctions.length,')'),React.createElement('button',{className:'modal-close',onClick:function(){setShowUnused(false);}},'Ã—')),
                React.createElement('div',{className:'modal-body',style:{maxHeight:'60vh',overflowY:'auto'}},
                    React.createElement('div',{style:{fontSize:10,color:'var(--t3)',marginBottom:12}},'These functions are not called from other files. They may be dead code, or called internally within the same file.'),
                    data.deadFunctions.map(function(fn,i){
                        var isExpanded=expandedFns.has('dead-'+fn.name);
                        return React.createElement('div',{key:i,className:'fn-item'},
                            React.createElement('div',{className:'fn-header',onClick:function(){toggleFn('dead-'+fn.name);}},
                                React.createElement('span',{className:'fn-name'},fn.name,'()'),
                                React.createElement('span',{style:{display:'flex',alignItems:'center',gap:6}},
                                    fn.line&&React.createElement('span',{className:'fn-line'},'L',fn.line),
                                    React.createElement('span',{className:'badge badge-default',style:{cursor:'pointer'},onClick:function(e){e.stopPropagation();selectFile(fn.file);setShowUnused(false);}},fn.file.split('/').pop())
                                )
                            ),
                            isExpanded&&fn.code&&React.createElement('div',{className:'fn-code'},fn.code)
                        );
                    })
                ),
                React.createElement('div',{className:'modal-footer'},
                    React.createElement('button',{className:'top-btn primary',onClick:function(){setShowUnused(false);}},'Close')
                )
            )
        ),
        toast&&React.createElement('div',{className:'toast '+(toast.type||'success'),'role':'alert'},toast.msg),
        error&&React.createElement('div',{style:{position:'fixed',bottom:20,right:20,background:'var(--red)',color:'white',padding:'12px 20px',borderRadius:8,zIndex:1000,maxWidth:350},'role':'alert'},error,React.createElement('button',{'aria-label':'Dismiss error',onClick:function(){setError(null);},style:{marginLeft:12,background:'none',border:'none',color:'white',cursor:'pointer',fontSize:16}},'Ã—'))
    );
}

ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
</script>
</body>
</html>
